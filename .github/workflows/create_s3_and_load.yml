name: Create_S3_bucket_and_
on: workflow_dispatch           #---Allows to run this workflow manually from the Actions tab

jobs:
  Lunch_S3_bucket:
    runs-on: ubuntu-latest
    name: Проверяем credential, настраиваеися, планируем ресурс и изготовляем
    steps:
      # Checks-out your repository under $GITHUB_WORKSPACE, so your job can access it
      - uses: actions/checkout@v2

      - name: Проверяет/ЗапрашиваетCredentials-Планируем-Строим
        uses: aws-actions/configure-aws-credentials@v1         #--??????
        with:
          aws-access-key-id: ${{ secrets.AWS_ACCESS_KEY_ID }}
          aws-secret-access-key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
          aws-region: ${{ secrets.AWS_REGION }}
      
      - name: Setup настройка Terraform
        uses: hashicorp/setup-terraform@v1
        with:
          terraform_version: 0.12.8
          
  
      - name: Terraform Init - Изучает
        id: init
        run: terraform init
        continue-on-error: true

      - name: Terraform Validate - Подтверждает                             #----как?
        id: validate
        run: terraform validate -no-color
        continue-on-error: true
        
  
      - name: Terraform Plan - Планирует
        id: plan
        run: terraform plan -no-color
        continue-on-error: true

      - name: Terraform Apply - Изготавливает
        id: apply
        run: terraform apply -auto-approve -no-color      #--- -auto-approve -no-color????????????????
        continue-on-error: true

#  checkout_for_output:
#    runs-on: ubuntu-latest
#    needs: Lunch_S3_bucket
#    name: Заходим и осматриваемся
#    steps:
#      - name: Checkout
#        uses: actions/checkout@v2
#      - name: List текущий репозиторий files и мы можем совершать над ними действия
#        run: ls -la  
#      - name: Заглянем в папку контейнера репозитория
#        run:  ls templates
#      - name: Запрашиваем полный путь
#        run:  pwd
        
#      - name: Проверяет/Запрашивает AWS Credentials
#        uses: aws-actions/configure-aws-credentials@v1         
#        with:
#         aws-access-key-id: ${{ secrets.AWS_ACCESS_KEY_ID }}
#         aws-secret-access-key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
#         aws-region: ${{ secrets.AWS_REGION }}
     
#      - name: List s3-website-html Bucket что я положил туда вручную!?
#        run: aws s3 ls s3://s3-website-html
#      - name: отобразим все экспортированные переменные окружения в текущей оболочки
#        run: export -p
      
 #     - name: Reinite backend
 #       id: init
 #       run: terraform init #-reconfigure
 #       continue-on-error: true  
 #     - name: Terraform States
 #       id: state
 #       run: terraform state list
 #       continue-on-error: true
  Loadind_data:
    runs-on: ubuntu-latest
    needs: Lunch_S3_bucket
    name: Загрузка S3 bucket
    steps:        
      - name: Checkout Репозиторий of Default
        uses: actions/checkout@v2
      - name: Запрашивает AWS Credentials
        uses: aws-actions/configure-aws-credentials@v1         
        with:
         aws-access-key-id: ${{ secrets.AWS_ACCESS_KEY_ID }}
         aws-secret-access-key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
         aws-region: ${{ secrets.AWS_REGION }}
         
        
      - name: load содержимое Prefix контейнера в s3 bucket
        run: aws s3 cp /home/runner/work/static_files/static_files/templates/ s3://s3-website-html/ --recursive
      - name: List s3-website-html Bucket after
        run: aws s3 ls s3://s3-website-html
